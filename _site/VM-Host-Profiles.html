<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>VM Host Profiles | vcl</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="VM Host Profiles" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Documentation for the Apache VCL (Virtual Computing Lab) project" />
<meta property="og:description" content="Documentation for the Apache VCL (Virtual Computing Lab) project" />
<link rel="canonical" href="http://localhost:4000/VM-Host-Profiles.html" />
<meta property="og:url" content="http://localhost:4000/VM-Host-Profiles.html" />
<meta property="og:site_name" content="vcl" />
<script type="application/ld+json">
{"url":"http://localhost:4000/VM-Host-Profiles.html","headline":"VM Host Profiles","description":"Documentation for the Apache VCL (Virtual Computing Lab) project","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=c4acafeb8164e1bbb60bac1d516570dc35afbc91">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">

      <h1><a href="http://localhost:4000/">VM Host Profiles</a></h1> 


      <ul>
  <li>A VM host profile contains several parameters which describe how a VM host is configured so that VCL knows how to manage it</li>
  <li>Each VM host is assigned a VM host profile</li>
  <li>A VM host profile may be assigned to multiple VM hosts if they are configured identically</li>
  <li>VM host profiles may be added or modified via Virtual Hosts &gt; VM Host Profiles tab</li>
</ul>

<h2 id="parameters">Parameters</h2>

<h3 id="general-parameters">General Parameters</h3>

<p>Name</p>

<ul>
  <li>Descriptive name of the VM host profile</li>
</ul>

<p>Image (optional)</p>

<ul>
  <li>
    <p>VCL hypervisor image installed on VM host computers using xCAT</p>

    <p>xCAT is not required.  VM host computers may be installed manually or by some other means.</p>
  </li>
  <li>If xCAT is not used, select “No Image”</li>
  <li>VCL has the ability to install a hypervisor image on bare-metal computers using xCAT.  If the image property is configured, the image is installed when a computer’s state is changed to vmhostinuse via Manage Computers &gt; Computer Utilities</li>
</ul>

<p>Username/Password (optional)</p>

<ul>
  <li>Name and password of the administrative or root user residing on the VM host</li>
  <li>This account is used to manage the VM host and VMs assigned to the host</li>
  <li>The username and password are currently only used if the VMware vSphere SDK is used to manage the VM host and VMs</li>
</ul>

<h3 id="storage-parameters">Storage Parameters</h3>

<p>Resource Path (optional)</p>

<ul>
  <li>Resource Path only needs to be configured if VMware vCenter is used. It defines the location where VMs will be created in the vCenter inventory tree. The inventory tree contains at least one Datacenter, and may also contain Folders, Clusters, and Resource Pools.
Example: /DatacenterA/Folder1/Cluster2/ResourcePool3</li>
</ul>

<p>Repository Path (optional)</p>

<ul>
  <li>Path where master copies of images are stored which are used to transfer images to VM host datastores or to other repositories:
    <ul>
      <li>If a reservation is assigned to a host but the image does not exist in that host’s datastore, it is copied from the repository to the virtual disk path when the VM is loaded</li>
      <li>If the VCL environment contains multiple management nodes and the image does not exist in the repository or the host’s datastore, the image will be retrieved from another management node’s repository by copying it via SCP</li>
    </ul>
  </li>
  <li>The Repository Path parameter does not need to be configured if the VCL environment contains a single management node and all VM hosts share the same Virtual Disk Path
Example: /vmfs/volumes/nfs-repository1</li>
  <li>VMs do not run directly off of the images stored in the repository</li>
  <li>Setting the Repository Path parameter determines whether or not an additional copy of an image is created when an image is captured
    <ul>
      <li>If repository path is not configured then only a single copy of the image will exist in the virtual disk path after an image is captured</li>
      <li>If repository path is configured then two copies of the image will exist after an image is captured - one in the virtual disk path and one in the repository</li>
    </ul>
  </li>
  <li>Repository Path location can refer to and be mounted on either the management node or VM host
    <ul>
      <li>It is highly recommended that the repository be mounted on the VM host
        <ul>
          <li>When mounted on the VM host, vmdk operations can be done directly on the VM host in a single step</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Images in the repository are stored in the 2 GB sparse vmdk format
    <ul>
      <li>The size of the vmdk files will approximately be equal to the amount of actual data saved in the image regardless of the size of the VM’s hard drive</li>
      <li>Storing images in the 2 GB sparse format is necessary to allow images to be transferred via SCP without having to transfer data equal to the entire size of the VM’s hard drive</li>
    </ul>
  </li>
</ul>

<p>Repository Image Type</p>

<ul>
  <li>Virtual disk file format for images stored in the repository.</li>
  <li>Disk files can be automatically converted between qcow2 and vmdk formats as reservations are deployed. (conversion from/to .vdi may also work)</li>
</ul>

<p>Virtual Disk Path (previously Datastore Path)</p>

<ul>
  <li>Location where master copies of images are stored which are used by running VMs</li>
  <li>
    <p>Example: /vmfs/volumes/nfs-datastore1</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  For ESXi, the path configured in the profile may simply be the short datastore name as it appears in the vSphere Client: nfs-datastore1
</code></pre></div>    </div>
  </li>
  <li>Storage location should be large enough to store all of the images which may be loaded on the VM host (from 100’s of GB to several TB)</li>
  <li>VCL creates a directory for each image in the Virtual Disk Path</li>
  <li>Images are stored in the vmfs thin vmdk format or qcow2 format</li>
  <li>Virtual Disk Path may either reside on local or network storage</li>
  <li>Multiple VM hosts can share the same datastore if network storage is used
    <ul>
      <li>A single datastore may be used by all VM hosts if performance is adequate</li>
      <li>Multiple running VMs on different hosts may access the same Virtual Disk Path image at the same time</li>
      <li>It is recommended that datastores are shared among hosts so that fewer copies of each image have to be stored</li>
      <li>The underlying storage hardware and network connectivity from the hosts to the storage must be adequate</li>
      <li>Storage where the datastore is located should be optimized for read performance</li>
    </ul>
  </li>
  <li>VCL configures VMs to access images stored in the Virtual Disk Path in read-only mode
    <ul>
      <li>Changes made to the VM’s hard drive are written to delta files located in the VM Working Directory Path dedicated for the VM</li>
    </ul>
  </li>
</ul>

<p>Virtual Disk Image Type</p>

<ul>
  <li>Virtual disk file format for images stored in the virtual disk path.</li>
</ul>

<p>Virtual Disk Mode (previously VM Disk)</p>

<ul>
  <li>Defines whether the storage where the VM host’s Virtual Disk Path resides is dedicated to a single host or shared among multiple hosts:
    <ul>
      <li>Dedicated (previously localdisk)
        <ul>
          <li>The VM host’s Virtual Disk Path is located on local disks or dedicated network storage</li>
          <li>The VM host is the only host which accesses the Virtual Disk Path</li>
          <li>Repository Path must be configured</li>
        </ul>
      </li>
      <li>Shared (previously networkdisk)
        <ul>
          <li>The VM host’s Virtual Disk Path is located on network storage which is shared by other VM hosts</li>
          <li>
            <p>Repository Path is optional</p>

            <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  The Virtual Disk Mode (VM Disk) parameter does not determine whether or not:
  ...images are copied from the datastore to the repository during image capture
  ...images are copied from the repository to the datastore during image load
  These are determined by whether or not Repository Path is configured in the profile
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>VM Working Directory Path (optional) (previously VM Path)</p>

<ul>
  <li>Defines path on VM host where VM working directories will reside (contains .vmx, delta, .vswp, nvram files)</li>
  <li>If not configured, the Virtual Disk Path location will be used</li>
  <li>VCL creates a directory under the VM Working Directory Path for each VM it creates
    <ul>
      <li>Contains the .vmx file which defines the VM (for VMware)</li>
      <li>Contains delta vmdk or qcow2 files which are written to as changes are made to the VM’s hard drive</li>
    </ul>
  </li>
  <li>VM Working Directory Path may either reside on local or network storage</li>
  <li>Location should be dedicated for each VM host
    <ul>
      <li>Multiple VM hosts should not share the same VM Working Directory Path location for performance and image safety reasons</li>
      <li>VM Working Directory Paths of multiple hosts may reside on the same volume but a subdirectory should be created for each host</li>
    </ul>
  </li>
  <li>Storage where the VM Working Directory Path is located should be optimized for read-write performance</li>
</ul>

<h3 id="networking-parameters">Networking Parameters</h3>

<p>VM Network (previously Virtual Switch)</p>

<ul>
  <li>VM Network 0 (previously Virtual Switch 0) - private VCL management network</li>
  <li>VM Network 1 (previously Virtual Switch 1) - public network used by user making reservation to access the VMs</li>
  <li>The VM Network parameters should match the network names configured on the VM host
    <ul>
      <li>For ESXi, the VM Network parameters must match the Virtual Machine Port Group Network Labels configured in the vSphere Client, example:
        <ul>
          <li>VM Network 0: Public</li>
          <li>VM Network 1: Private</li>
        </ul>

        <p><img src="images/vmware-network-labels.gif" width="400" border="1" /></p>
      </li>
    </ul>
  </li>
  <li>For KVM hosts, the names must match network interface names or Virtual Network names (Virtual Network names added in 2.5)</li>
</ul>

<p>Generate eth0/eth1 MAC</p>

<ul>
  <li>New in VCL 2.3</li>
  <li>Determines whether VMs are assigned MAC addresses defined in the VCL database or if random MAC addresses should be assigned</li>
</ul>

<h2 id="configuration-examples">Configuration Examples</h2>

<h3 id="local-disk-only---repository-mounted-via-nfs">Local Disk Only - Repository Mounted via NFS</h3>

<p><img src="images/local-only-nfs.gif" width="400" border="1" /></p>

<p>The diagram above shows a simple VCL configuration with 1 management node and 2 VMware ESXi hosts.  Network storage is not used.
The local disks on the VM hosts are used to store all of the files used by running VMs including the VM’s working directory and the master vmdk image.</p>

<p>A directory on the local disk on the management node is used to as the image repository.  This directory is exported via NFS.  VM hosts mount this directory as a datastore named “repository”.  Mounting the repository directly on the VM hosts allows the vmkfstools utility to be used on the VM hosts to copy and convert images directly from the repository to the local datastore in a single step.</p>

<p>If an image is to be loaded on a VM host and that image does not already exist in the VM host’s local datastore (Virtual Disk Path), it is automatically copied from the repository to the VM host’s local datastore (Virtual Disk Path) at the beginning of the load process.</p>

<p>During image capture, images are automatically copied to from the VM host’s local datastore (Virtual Disk Path) to the repository.  This allows images captured on a VM host to be loaded on any other VM host.</p>

<p>The VM host profile Virtual Disk Mode parameter is set to dedicated.  This indicates to the load process that the VM host’s Virtual Disk Path is dedicated to the VM host and not shared by other VM hosts.  This allows images to be deleted from the VM host’s local datastore (Virtual Disk Path) if another image must be copied from the repository and not enough space is available.</p>

<h3 id="local-disk-only---repository-not-available-via-nfs">Local Disk Only - Repository Not Available via NFS</h3>

<p><img src="images/local-only-scp.gif" width="400" border="1" /></p>

<p>This example is identical to the one above except that the repository located on the management node’s local disk is not exported via NFS.  Because of this, images must be transferred using SCP instead of vmkfstools.  This is less desirable than mounting the repository directly on the VM hosts because images cannot be copied and converted in a single step.  Images are stored in the repository in the 2GB sparse format.  This allows the images to be copied via SCP while only transferring the data stored in the image, not the entire size of the hard drive stored in the image.  VMware ESXi cannot run VMs using vmdk images stored in the 2GB sparse format.  Images are converted to the vmfs thin format so that they can be loaded on VMware ESXi.  This adds extra time to the load process if an image does not exist in the VM’s local datastore (Virtual Disk Path) and must be copied from the repository.  It also requires additional space in the VM host’s local datastore (Virtual Disk Path) becuase 2 copies of the image exist while it is being converted.
Note that the VM host profile Repository Path parameter is set to the path on the management node’s hard drive.  The code first checks if the path exists on the VM host.  If not, it assumes the repository is not mounted directly on the VM host and the Repository Path value refers to a location on the management node.</p>

<h3 id="network-storage-only---no-repository">Network Storage Only - No Repository</h3>

<p><img src="images/network-only-no-repo.gif" width="400" border="1" /></p>

<p>This is an example of a simple configuration where the network storage is used.</p>

<p>A repository is not used in this configuration.  This implies that all VM hosts which will ever be added to this VCL environment will need to be able to connect to the network storage.</p>

<p>A datastore to be used as the Virtual Disk Path named “datastore” is mounted on every VM host.  Each of these mounts points to the same location on the network storage.  The datastore will contain the master vmdk images.  VMs loaded on the VM hosts will read from these master vmdk images.</p>

<p>A datastore to be used as the VM Working Directory Path named “vmpath” is also mounted on each VM host.  However, the location to which each VM host points should be different.  In the example above, vmhost-a-01 points to th the /vmpath01 directory on the network storage and vmhost-a-02 points to the /vmpath02 directory.  These locations may be different network storage filesystems or may be different directories on the same network filesystem.  Even though the mounts on the VM hosts point to different locations, the datastore names configured under ESXi are identical.  This allows you to use the same VCL VM host profile for all of the VM hosts.</p>

<p>The VM host profile Virtual Disk Mode parameter is set to shared.  This indicates to the load process that the VM host’s Virtual Disk Path is shared by other VM hosts.</p>


      
      <div class="footer border-top border-gray-light mt-5 pt-3 text-right text-gray">
        This site is open source. <a href="http://github.com/pathoma4/vcl/edit/gh-pages/VMHostProfiles.md">Improve this page</a>.
      </div>
      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
