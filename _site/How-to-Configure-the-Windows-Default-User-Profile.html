<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>How to Configure the Windows Default User Profile | vcl</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="How to Configure the Windows Default User Profile" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Documentation for the Apache VCL (Virtual Computing Lab) project" />
<meta property="og:description" content="Documentation for the Apache VCL (Virtual Computing Lab) project" />
<link rel="canonical" href="http://localhost:4000/How-to-Configure-the-Windows-Default-User-Profile.html" />
<meta property="og:url" content="http://localhost:4000/How-to-Configure-the-Windows-Default-User-Profile.html" />
<meta property="og:site_name" content="vcl" />
<script type="application/ld+json">
{"url":"http://localhost:4000/How-to-Configure-the-Windows-Default-User-Profile.html","headline":"How to Configure the Windows Default User Profile","description":"Documentation for the Apache VCL (Virtual Computing Lab) project","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=5a462ccebd38c405a5d0383f2220b85b4c0a08c1">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">

      <h1><a href="http://localhost:4000/">How to Configure the Windows Default User Profile</a></h1> 


      <p>A Windows user profile defines the look and feel of the desktop environment configured for a particular user. It contains various settings such as desktop colors, backgrounds, icon placement, and Windows Explorer settings.</p>

<p>The default profile is a template profile that is used when a user logs on to a Windows computer for the first time. The default profile can be customized by the image creator.</p>

<ul>
  <li><a href="#windows-7-and-windows-server-2008">Windows 7 and Windows Server 2008</a>
    <ul>
      <li><a href="#enable-desktop-background">Enable Desktop Background</a></li>
      <li><a href="#create-a-profile-setup-account">Create a Profile Setup Account</a></li>
      <li><a href="#configure-the-user-profile-for-the-profile-setup-account">Configure the User Profile for the Profile Setup Account</a></li>
      <li><a href="#copy-the-customized-profile-to-default">Copy the Customized Profile to Default</a></li>
      <li><a href="#clean-the-registry-for-the-customized-profile">Clean the Registry for the Customized Profile</a></li>
      <li><a href="#configure-the-user-account-picture-optional">Configure the User Account Picture (Optional)</a></li>
      <li><a href="#force-the-desktop-background-to-appear-on-windows-7--windows-server-2008-optional">Force the Desktop Background to Appear on Windows 7 &amp; Windows Server 2008 (Optional)</a></li>
    </ul>
  </li>
  <li><a href="#windows-xp-and-windows-server-2003">Windows XP and Windows Server 2003</a>
    <ul>
      <li><a href="#create-a-profile-configuration-account">Create a Profile Configuration Account</a></li>
      <li><a href="#copy-the-customized-profile-to-default-user">Copy the Customized Profile to “Default User”</a></li>
      <li><a href="#clean-up-the-profile-configuration-account">Clean up the Profile Configuration Account</a></li>
    </ul>
  </li>
</ul>

<h2 id="windows-7-and-windows-server-2008">Windows 7 and Windows Server 2008</h2>

<p>Microsoft does not support copying profiles under Windows 7 and Windows Server 2008. The “Copy To” button is grayed out for all profiles except the default profile.</p>

<p>The only supported method is built into Sysprep and this method is itself very problematic. The following steps are not supported or recommended by Microsoft but seem to work:</p>

<h3 id="enable-desktop-background">Enable Desktop Background</h3>
<ol>
  <li>Download and edit the RDP file for your imaging reservation from the VCL website to allow desktop backgrounds or else you won’t be able to change the desktop background color
    <ol>
      <li>Right-click on the .rdp file and select Edit</li>
      <li>Click on the Experience tab</li>
      <li>Select LAN (10 Mbps or higher)</li>
      <li>Make sure the checkbox next to Desktop background is enabled</li>
    </ol>

    <p><img src="images/rdp-desktop-background.png" width="400" border="1" /></p>

    <ol>
      <li>Click on General Tab</li>
      <li>Click Save</li>
    </ol>
  </li>
  <li>Login to the VCL reservation as Administrator</li>
  <li>Configure Windows Explorer to show hidden and system file
    <ol>
      <li>Open Windows Explorer</li>
      <li>Click Organize &gt; Folder and search options</li>
      <li>Select the View tab</li>
      <li>Select the radio button next to Show hidden files, folders, and drives</li>
      <li>Click OK</li>
    </ol>
  </li>
</ol>

<h3 id="create-a-profile-setup-account">Create A Profile Setup Account</h3>

<ol>
  <li>Create a new local user account named ProfileSetup (<em>Note: the name does not matter but should be something that would not match another string in the stock Windows registry. You will be searching the registry for the name of the user you use to configure the profile. Using a unique name will make this easier.</em>)
    <ol>
      <li>Open Control Panel &gt; Add or remove user accounts</li>
      <li>If there is already an account named ProfileSetup and you want to start over with a new account, delete the existing account and then create a new one:
        <ol>
          <li>Click on the ProfileSetup user</li>
          <li>Click Delete the account</li>
          <li>Click Delete Files</li>
          <li>Click Delete Account</li>
        </ol>
      </li>
      <li>Click Create a new account</li>
      <li>Enter the account name: ProfileSetup</li>
      <li>Click the radio button next to Administrator</li>
      <li>Click Create Account</li>
    </ol>
  </li>
  <li>Set the password for the ProfileSetup account
    <ol>
      <li>Click on the ProfileSetup account</li>
      <li>Click Create a password</li>
      <li>Enter the password and click Create password</li>
    </ol>
  </li>
</ol>

<h3 id="configure-the-user-profile-for-the-profile-setup-account">Configure the User Profile for the Profile Setup Account</h3>

<ol>
  <li>
    <p>Logout as Administrator and login as ProfileSetup</p>

    <p>If you intend to arrange the icons on the desktop, use a screen size of 1024x768 when logged in as ProfileSetup.  This is the default screen size that most users will use when they connect to VCL reservations.  If you arrange the icons using a custom screen size, the icons most users see will be rearranged when they connect using the default size.</p>
  </li>
  <li>
    <p>Customize the user profile while logged in as ProfileSetup account (<em>configure the desktop background, arrange icons, etc</em>).  The following tips are optional:</p>
    <ol>
      <li>Download and run <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/autoruns">Autoruns</a>.  This free utility will show you all of the things that run when the computer boots, a user logs in, etc. There are several things that can probably be disabled such as Windows Mail.</li>
    </ol>
  </li>
</ol>

<h3 id="copy-the-customized-profile-to-default">Copy the Customized Profile to Default</h3>

<ol>
  <li>Logout as ProfileSetup and login as Administrator</li>
  <li>Rename the ProfileSetup user profile folder to Default:
    <ol>
      <li>Open a Windows Explorer window and navigate to C:\Users</li>
      <li>Rename the original default profile folder: C:\Users\Default -&gt; C:\Users\DefaultOriginal</li>
      <li>
        <p>Rename the customized profile folder: C:\Users\ProfileSetup -&gt; C:\Users\Default
 <em>Note: if you are unable to rename the ProfileSetup folder, reboot the computer, login as Administrator, and try again. Run the following command from a command prompt to reboot the computer:</em></p>

        <p>shutdown.exe -r -f -t 0</p>
      </li>
    </ol>
  </li>
  <li>Copy the customized profile folder using the Windows profile copying utility:
<em>Note: Windows 7 only allows its built-in profile copying utility to be used to copy the default profile, not profiles of other user accounts. The profile you customized now resides in the default profile location (C:\Users\Default) so the utility can now be used to make a copy of it.</em>
    <ol>
      <li>Open Control Panel &gt; System and Security &gt; System</li>
      <li>Click Advanced system settings on the left</li>
      <li>Click the Settings… button under User Profiles</li>
      <li>Highlight Default Profile</li>
      <li>Click Copy To…
        <ol>
          <li>Copy profile to: C:\Users\DefaultCopy</li>
          <li>Click Change under Permitted to use</li>
          <li>Enter Everyone and click OK</li>
          <li>Click OK</li>
        </ol>
      </li>
    </ol>
  </li>
  <li>Replace the original customized profile directory with the one created by the Windows profile copying utility
<em>Note: C:\Users\Default contains the original customized profile. The same profile also resides in C:\Users\DefaultCopy. The DefaultCopy folder is the one which has had the Windows profile copying utility transformations applied to it.</em>
    <ol>
      <li>Open Windows Explorer</li>
      <li>Delete the “C:\Users\Default folder</li>
      <li>Rename the folder: C:\UsersDefaultCopy -&gt; C:\Users\Default</li>
    </ol>
  </li>
  <li>Delete the ProfileSetup account:
    <ol>
      <li>Open Control Panel &gt; Add or remove user accounts</li>
      <li>Click on the ProfileSetup account</li>
      <li>Click Delete the account</li>
      <li>Click Delete Files</li>
      <li>Click Delete Account</li>
    </ol>
  </li>
</ol>

<h3 id="clean-the-registry-for-the-customized-profile">Clean the Registry for the Customized Profile</h3>

<ol>
  <li>While logged in as Administrator</li>
  <li>Run regedit.exe</li>
  <li>
    <p>Select the HKEY_USERS hive:</p>

    <p><img src="images/hkey-users-hive.png" width="400" border="1" /></p>
  </li>
  <li>
    <p>Click the File menu and select Load Hive:</p>

    <p><img src="images/load-hive.png" width="400" border="1" /></p>
  </li>
  <li>Browse to C:\Users\Default</li>
  <li>
    <p>Enter ntuser.dat in the File name: field (<em>Note: this file is hidden so it normally is not displayed in the list of files</em>)</p>

    <p><img src="images/ntuser-dat.png" width="400" border="1" /></p>
  </li>
  <li>
    <p>Enter a Key Name: DU</p>

    <p><img src="images/regedit-du.png" width="400" border="1" /></p>
  </li>
  <li>
    <p>Navigate to:
<strong>HKEY_USERS\DU\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders</strong></p>

    <p>You will probably see the path to the ProfileSetup account’s original user profile directory saved in many of the values as highlighted below.  This can cause problems with programs which use these values.  For example, a user may save a file to the Desktop from within a program, but the saved file doesn’t appear on the user’s desktop.</p>

    <p><img src="images/shell-folders.png" width="400" border="1" /></p>
  </li>
  <li>
    <p>Delete all of the values under Shell Folders except for (Default) and <strong>“!Do not use this registry key”:</strong></p>

    <p><img src="images/shell-folders-clean.png" width="400" border="1" /></p>
  </li>
  <li>Select the DU key in the left pane</li>
  <li>Click on the Edit menu and select Find…</li>
  <li>Search the DU key for the string ProfileSetup.  In general, you want to clean up everything that references the user named ProfileSetup and the <strong>C:\Users\ProfileSetup</strong> directory.  There will probably be several places under DU where these are saved.  You will need to analyze each match.  Most matches won’t cause problems.  Some will such as the Shell Folders key you previously cleaned up.</li>
  <li><strong><em>IMPORTANT</em></strong>: Unload the Default user registry hive:
    <ol>
      <li>Select the DU key</li>
      <li>Click the File menu and select Unload hive…</li>
    </ol>
  </li>
</ol>

<p>Any new local user accounts created on the computer should receive a user profile configured with the customizations you made to the Profile account.</p>

<h3 id="configure-the-user-account-picture-optional">Configure the User Account Picture (Optional)</h3>

<ol>
  <li>Navigate to the directory: C:\ProgramData\Microsoft\User Account Pictures
(<em>Note: you will need to enable “Show hidden files” to see this directory</em>)</li>
  <li>Rename user.bmp to something such as user-original.bmp</li>
  <li>Copy the .bmp file you want used as the account picture to this directory and name it user.bmp</li>
</ol>

<h3 id="force-the-desktop-background-to-appear-on-windows-7--windows-server-2008-optional">Force the Desktop Background to Appear on Windows 7 &amp; Windows Server 2008 (Optional)</h3>

<p>The following procedure should force a desktop wallpaper image to be displayed for all users regardless of whether or not the Desktop Background option is selected in the .rdp file.  This could be useful if you want a logo or an image containing instructions for the user to always be displayed.</p>

<p>There are some local group policy settings which can be configured to force a wallpaper to be shown and prevent users from changing it.  However, this only seems to work if the Desktop Background option is selected in the .rdp file.</p>

<p>You may encounter difficulty getting the wallpaper to be displayed under all situations.  One known situation is when a user connects with the Desktop Background option disabled.  The wallpaper should be displayed initially.</p>

<p>If the user disconnects from the remote computer (but does not log out) and then reconnects, the wallpaper will probably not appear.</p>

<ol>
  <li>Run gpedit.msc</li>
  <li>Navigate to User Configuration &gt; Windows Settings &gt; Scripts (Logon/Logoff)</li>
  <li>Double-click Logon</li>
  <li>
    <p>Click Show Files…</p>

    <p>The following directory should open: C:\Windows\System32\GroupPolicy\User\Scripts\Logon</p>
  </li>
  <li>Create a new text file with a .cmd extension in this directory</li>
  <li>
    <p>Add the following to the file:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> set WALLPAPER_PATH=%1

 reg.exe ADD "HKEY_CURRENT_USER\Remote\2\Control Panel\Desktop" /v Wallpaper /d "%WALLPAPER_PATH%" /f

 reg.exe ADD "HKEY_CURRENT_USER\Remote\2\Control Panel\Desktop" /v WallpaperStyle /d 0 /f

 reg.exe ADD "HKEY_CURRENT_USER\Control Panel\Desktop" /v Wallpaper /d "%WALLPAPER_PATH%" /f

 reg.exe ADD "HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Desktop\General" /v WallpaperSource /d "%WALLPAPER_PATH%" /f
</code></pre></div>    </div>
  </li>
  <li>Save the .cmd file</li>
  <li>
    <p>Click the Add… button on the Logon Properties pane:</p>

    <p><img src="images/add-logon-script.png" width="400" border="1" /></p>
  </li>
  <li>Click Browse…</li>
  <li>Select the .cmd file and click Open</li>
  <li>
    <p>Enter the path to an image file in the Script Parameters box:</p>

    <p><img src="images/add-script.png" width="400" border="1" /></p>
  </li>
  <li>Click OK twice</li>
  <li>Close the Local Group Policy Editory</li>
  <li>Run gpupdate.exe /force</li>
</ol>

<h2 id="windows-xp-and-windows-server-2003">Windows XP and Windows Server 2003</h2>

<h3 id="create-a-profile-configuration-account">Create a Profile Configuration Account</h3>

<ol>
  <li>While logged on as Administrator , create a local Windows user account named Profile and add it to the Administrators group</li>
  <li>Configure the profile:
    <ol>
      <li>Log on as Profile</li>
      <li>Make desired profile, desktop, and application changes</li>
      <li>Log out</li>
    </ol>
  </li>
</ol>

<h3 id="copy-the-customized-profile-to-default-user">Copy the Customized Profile to “Default User”</h3>

<ol>
  <li>Log back on as Administrator</li>
  <li>Rename the C:\Documents and Settings\Default User directory to something like Default User Original</li>
  <li>Open the Control Panel</li>
  <li>Open System Properties</li>
  <li>Select the Advanced tab</li>
  <li>Click the Settings button next to User Profiles</li>
  <li>Select Profile’s profile, click Copy To :
 Copy profile to: C:\Documents and Settings\Default User
 Permitted to use: add the Everyone group</li>
  <li>Click OK</li>
</ol>

<h3 id="clean-up-the-profile-configuration-account">Clean up the Profile Configuration Account</h3>

<ol>
  <li>Delete the Profile user</li>
  <li>Delete C:\Documents and Settings\Profile</li>
</ol>

<p>You can then create another account and log in using it to make sure your profile settings take affect for new users. Be sure to delete it once you’re done testing.</p>


      
      <div class="footer border-top border-gray-light mt-5 pt-3 text-right text-gray">
        This site is open source. <a href="http://github.com/pathoma4/vcl/edit/gh-pages/HowToConfigureTheWindowsDefaultUserProfile.md">Improve this page</a>.
      </div>
      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
