<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>KVM Configuration | vcl</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="KVM Configuration" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Documentation for the Apache VCL (Virtual Computing Lab) project" />
<meta property="og:description" content="Documentation for the Apache VCL (Virtual Computing Lab) project" />
<link rel="canonical" href="http://localhost:4000/KVM-Configuration.html" />
<meta property="og:url" content="http://localhost:4000/KVM-Configuration.html" />
<meta property="og:site_name" content="vcl" />
<script type="application/ld+json">
{"url":"http://localhost:4000/KVM-Configuration.html","headline":"KVM Configuration","description":"Documentation for the Apache VCL (Virtual Computing Lab) project","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=b671feb74595371c5de420586c58c64f729bf89f">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">

      <h1><a href="http://localhost:4000/">KVM Configuration</a></h1> 


      <h3 id="install-packages">Install Packages</h3>

<p>The following commands will install the Linux packages required for VCL to manage a KVM host:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum install libvirt virt-manager dejavu-lgc-sans-fonts bridge-utils libguestfs-tools -y
/sbin/chkconfig libvirtd on

echo "Starting the libvirtd service..."
/sbin/chkconfig libvirtd on
/sbin/service libvirtd start
</code></pre></div></div>

<p>The virt-manager package is optional.  It is a graphical utility which is used to manage KVM and other hypervisors controlled via libvirt.  The dejavu-lgc-sans-fonts package is usually necessary in order for virt-manager to render fonts correctly.</p>

<h3 id="configure-networking">Configure Networking</h3>

<p>The following commands will configure networking to allow KVM guests to communicate.  It configures a bridge named br0 on eth0, and br1 on eth1.  When configured this way, the network names in the VM host profile should be set to br0 and br1.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo "Stopping the NetworkManager service..."
chkconfig NetworkManager off 2&gt;/dev/null
service NetworkManager stop 2&gt;/dev/null
yum erase NetworkManager -y

cat &gt; /etc/sysconfig/network-scripts/ifcfg-eth0 &lt;&lt;EOF
DEVICE=eth0
ONBOOT=yes
BRIDGE=br0
NM_CONTROLLED=no
EOF
echo "Configured ifcfg-eth0:"
cat /etc/sysconfig/network-scripts/ifcfg-eth0

cat &gt; /etc/sysconfig/network-scripts/ifcfg-br0 &lt;&lt;EOF
DEVICE=br0
TYPE=Bridge
BOOTPROTO=dhcp
ONBOOT=yes
DELAY=0
NM_CONTROLLED=no
EOF
echo "Configured ifcfg-br0:"
cat /etc/sysconfig/network-scripts/ifcfg-br0

cat &gt; /etc/sysconfig/network-scripts/ifcfg-eth1 &lt;&lt;EOF
DEVICE=eth1
ONBOOT=yes
BRIDGE=br1
NM_CONTROLLED=no
EOF
echo "Configured ifcfg-eth1:"
cat /etc/sysconfig/network-scripts/ifcfg-eth1

cat &gt; /etc/sysconfig/network-scripts/ifcfg-br1 &lt;&lt;EOF
DEVICE=br1
TYPE=Bridge
BOOTPROTO=dhcp
ONBOOT=yes
DELAY=0
NM_CONTROLLED=no
EOF
echo "Configured ifcfg-br1:"
cat /etc/sysconfig/network-scripts/ifcfg-br1

echo "Configuring eth0 bridge..."
ifdown br0 2&gt;/dev/null
brctl delbr br0 2&gt;/dev/null
brctl addbr br0
brctl addif br0 eth0

echo "Configuring eth1 bridge..."
ifdown br1 2&gt;/dev/null
brctl delbr br1 2&gt;/dev/null
brctl addbr br1
brctl addif br1 eth1

/sbin/chkconfig network on
/sbin/service network restart
</code></pre></div></div>

<h3 id="add-a-network-storage-pool">Add a Network Storage Pool</h3>

<p>The following commands will add an NFS storage pool named images to the KVM host.  The /images directory is exported via NFS from host 10.10.10.1.  This directory is mounted as /mnt/kvm1 on the KVM host.  An entry is added to /etc/fstab to ensure the directory is mounted if the KVM host is rebooted.</p>

<h3 id="add-a-local-storage-pool">Add a Local Storage Pool</h3>

<p>The following commands will define a storage pool named local-vms pointing to the /vms directory on the local disk:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo "Adding the local-vms pool..."
virsh pool-destroy local-vms 2&gt;/dev/null
virsh pool-undefine local-vms 2&gt;/dev/null
mkdir /vms 2&gt;/dev/null
chmod -R 755 /vms
virsh pool-define-as --name local-vms --type dir --target /vms
virsh pool-autostart --pool local-vms
virsh pool-start local-vms
</code></pre></div></div>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
