<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>How to Increase the Size of a Virtual Machine Hard Drive Under VMware ESXi | vcl</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="How to Increase the Size of a Virtual Machine Hard Drive Under VMware ESXi" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Documentation for the Apache VCL (Virtual Computing Lab) project" />
<meta property="og:description" content="Documentation for the Apache VCL (Virtual Computing Lab) project" />
<link rel="canonical" href="http://localhost:4000/How-To-Increase-The-Size-Of-A-Virtual-Machine-Hard-Drive-Under-VMware-ESXi.html" />
<meta property="og:url" content="http://localhost:4000/How-To-Increase-The-Size-Of-A-Virtual-Machine-Hard-Drive-Under-VMware-ESXi.html" />
<meta property="og:site_name" content="vcl" />
<script type="application/ld+json">
{"url":"http://localhost:4000/How-To-Increase-The-Size-Of-A-Virtual-Machine-Hard-Drive-Under-VMware-ESXi.html","headline":"How to Increase the Size of a Virtual Machine Hard Drive Under VMware ESXi","description":"Documentation for the Apache VCL (Virtual Computing Lab) project","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=5a462ccebd38c405a5d0383f2220b85b4c0a08c1">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">

      <h1><a href="http://localhost:4000/">How to Increase the Size of a Virtual Machine Hard Drive Under VMware ESXi</a></h1> 


      <p>This page describes how to increase the size of a VM’s hard drive. This is useful if additional space is needed to install large applications.</p>

<h3 id="create-a-full-copy-of-the-virtual-disk">Create a Full Copy of the Virtual Disk</h3>
<ul>
  <li>Determine the VMware host the VM is on</li>
  <li>Shutdown the VM</li>
  <li>Log in to the VM host via SSH</li>
  <li>
    <p>Navigate to the VM’s working directory (under the VM Working Directory Path configured in the VM profile)</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cd /vmfs/volumes/vmpath/vclv99-77_1846-v14
</code></pre></div>    </div>
  </li>
</ul>

<p>You should see several files in the directory:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    /vmfs/volumes/19873c05-fcd3d912/vclv99-77_1846-v14 # ls -l
    -rw-rw----    1 root     root               8684 Aug 13 16:34 nvram
    -rw-------    1 root     root         4294967296 Aug 13 16:32 vclv99-77_1846-v14-6197888b.vswp
    -rw-rw----    1 root     root              18926 Aug 13 16:32 vclv99-77_1846-v14-Snapshot1.vmsn
    -rw-rw----    1 root     root                498 Aug 13 16:32 vclv99-77_1846-v14.vmsd
    --wxrw--wx    1 root     root               3464 Aug 13 16:37 vclv99-77_1846-v14.vmx
    --w-rw--w-    1 root     root                273 Aug 13 16:32 vclv99-77_1846-v14.vmxf
    -rw-r--r--    1 root     root             137538 Aug 13 16:43 vmware.log
    -rw-rw----    1 root     root          268505088 Aug 13 19:50 vmwarewin7-Windows764bit1846-v14-000001-delta.vmdk
    -rw-rw----    1 root     root                432 Aug 13 16:32 vmwarewin7-Windows764bit1846-v14-000001.vmdk
</code></pre></div></div>

<p>The VM is configured to run in linked clone mode because a snapshot was created before the VM was powered on for the first time. The .vmdk files in this directory only contain changes made to the master image.</p>

<p>The master image can be determined by lookin in the .vmsn file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    snapshot0.disk0.fileName = "/vmfs/volumes/e17be478-2ac3b743/vmwarewin7-Windows764bit1846-v14/vmwarewin7-Windows764bit1846-v14.vmdk"
</code></pre></div></div>

<p>or</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    scsi0:0.fileName = "/vmfs/volumes/e17be478-2ac3b743/vmwarewin7-Windows764bit1846-v14/vmwarewin7-Windows764bit1846-v14.vmdk"
</code></pre></div></div>

<p>A full copy of the master image and delta files needs to be created in order to be able to resize the virtual disk.</p>

<p>Run the following command from the VM’s working directory on the VM host:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    vmkfstools -i vmwarewin7-Windows764bit1846-v14-000001.vmdk copy.vmdk -d thin

    /vmfs/volumes/19873c05-fcd3d912/vclv99-77_1846-v14 # vmkfstools -i vmwarewin7-Windows764bit1846-v14-000001.vmdk copy.vmdk -d thin
    Destination disk format: VMFS thin-provisioned
    Cloning disk 'vmwarewin7-Windows764bit1846-v14-000001.vmdk'...
    Clone: 100% done.
</code></pre></div></div>

<h3 id="resize-the-virtual-disk">Resize the Virtual Disk</h3>

<p>Run the following command to resize the virtual disk. The -X argument should specify the total size you want the virtual disk to be, not the amount of space to add to it:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    vmkfstools -X 50G copy.vmdk
</code></pre></div></div>

<h3 id="download-gparted-live-cd">Download Gparted Live CD</h3>

<p>Download the [GParted Live CD ISO image] (https://gparted.sourceforge.io/download.php) to one of the datastores mounted on the VM host.</p>

<p>The .iso file must reside on one of the datastores in order to be able to mount it on a VM.</p>

<h3 id="replace-the-vms-hard-drive-with-the-full-copy">Replace the VM’s Hard Drive with the Full Copy</h3>

<p>After the copy has been created, reconfigure the VM to use the copy of the disk instead of the original linked clone.</p>

<ul>
  <li>Open vSphere Client</li>
  <li>Right-click on the VM and select Edit Settings…</li>
  <li>Select Hard disk 1</li>
  <li>Click Remove</li>
  <li>Click Add…</li>
  <li>Select Use an existing virtual disk</li>
  <li>Navigate to the VM’s working directory and select the .vmdk corresponding to the full copy of the virtual disk you created earlier (copy.vmdk)</li>
</ul>

<h3 id="add-a-cd-drive-to-the-vm-pointing-to-the-gparted-live-cd-iso-file">Add a CD Drive to the VM Pointing to the GParted Live CD ISO File</h3>

<ul>
  <li>Click Add…</li>
  <li>Select CD/DVD Drive</li>
  <li>Use ISO image</li>
  <li>Navigate to the Gparted ISO image you downloaded earlier</li>
  <li>Make sure Connect at power on is selected</li>
</ul>

<h3 id="increase-the-power-on-boot-delay">Increase the Power On Boot Delay</h3>

<p>It can be difficult to catch the initial boot screen when the VM is powered on in order to press Escape to display the boot menu.</p>

<p>Add a delay:</p>

<ul>
  <li>Click on the Options tab</li>
  <li>Select Boot Options</li>
  <li>Set the Power On Boot Delay to a few seconds (4000 = 4 seconds)</li>
</ul>

<h3 id="use-gparted-to-reconfigure-the-partitions">Use GParted to Reconfigure the Partitions</h3>

<p>Simply increasing the size of the virtual disk does not cause the amount of usable space within the VM to increase.  The partitions within the virtual disk need to be reconfigured to use all of the available space.  This cannot be done from the OS of the image stored on the virtual disk.  You must boot the VM using a live CD containing a partition reconfiguration utility.  The GParted Live CD is free and easy to use.</p>

<ul>
  <li>With the VM powered off, select the Console tab</li>
  <li>Power on the VM</li>
  <li>Quickly click inside the Console pane</li>
  <li>Press Esc to display the Boot Menu</li>
  <li>Select CD-ROM Drive</li>
</ul>

<p>The GParted menu should appear.</p>

<ul>
  <li>Select GParted Live (Default settings)</li>
  <li>Accept the defaults</li>
</ul>

<p>Increase the size of the main partition to use all of the space</p>

<ul>
  <li>Select the main partition (should be the largest)</li>
  <li>Open the Partition menu (use the mouse of press Alt-p if mouse operations are difficult)</li>
  <li>Select Resize/Move</li>
  <li>Set New Size (MiB) to the Maximum size listed above in the box</li>
  <li>Click Resize/Move</li>
  <li>Open the Edit menu</li>
  <li>Click Apply All Operations</li>
  <li>Click Apply
  You should eventually see a message stating All operations successfully completed</li>
  <li>Click Close</li>
  <li>Reboot the VM to its hard drive
  If a message appears saying the hard drive needs to be checked for consistency allow the procedure to complete.</li>
  <li>Once the VM is rebooted, log in to the image and verify the size of the hard drive has been increased</li>
</ul>

<p>The saved VCL image will contain the larger hard drive.</p>


      
      <div class="footer border-top border-gray-light mt-5 pt-3 text-right text-gray">
        This site is open source. <a href="http://github.com/pathoma4/vcl/edit/gh-pages/HowToIncreaseTheSizeOfAVirtualMachineHardDriveUnderVMwareESXi.md">Improve this page</a>.
      </div>
      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
