<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Create a Linux Base Image | vcl</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Create a Linux Base Image" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Documentation for the Apache VCL (Virtual Computing Lab) project" />
<meta property="og:description" content="Documentation for the Apache VCL (Virtual Computing Lab) project" />
<link rel="canonical" href="http://localhost:4000/Create-A-Linux-Base-Image.html" />
<meta property="og:url" content="http://localhost:4000/Create-A-Linux-Base-Image.html" />
<meta property="og:site_name" content="vcl" />
<script type="application/ld+json">
{"url":"http://localhost:4000/Create-A-Linux-Base-Image.html","headline":"Create a Linux Base Image","description":"Documentation for the Apache VCL (Virtual Computing Lab) project","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=130772071a820f435247ba4c1f14ddba71f76171">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">

      <h1><a href="http://localhost:4000/">Create a Linux Base Image</a></h1> 


      <p>This page describes how to create a Linux base image.</p>

<h3 id="requirements">Requirements</h3>

<ul>
  <li>Computer being captured has been added to the VCL database</li>
  <li>Computer has been installed with Linux</li>
  <li>Two network adapters are enabled on the computer:
    <ul>
      <li>eth0 - connected to the private network</li>
      <li>eth1 - connected to the public network</li>
    </ul>
  </li>
  <li>The ability to log in as root via SSH using an identity key on the private network from management node</li>
</ul>

<h4 id="configure-ssh-identity-key-authentication">Configure SSH Identity Key Authentication</h4>
<ol>
  <li>
    <p>On the Linux computer being captured, create a /root/.ssh directory:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> mkdir /root/.ssh
</code></pre></div>    </div>
  </li>
  <li>
    <p>On the management node, copy the public SSH identity key to the authorized_keys file on the Linux computer being captured:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> scp /etc/vcl/vcl.key.pub &lt;hostname or IP address&gt;:/root/.ssh/authorized_keys
</code></pre></div>    </div>
  </li>
  <li>
    <p>Or replace the above two steps with the following on the management node:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ssh-copy-id -i /etc/vcl/vcl.key &lt;hostname or IP address&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>Make sure you can login from the management node to the Linux computer being captured using the identity key:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ssh -i /etc/vcl/vcl.key &lt;hostname or IP address&gt;
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="configure-the-ifcfg--files">Configure the ifcfg-* Files</h4>

<ol>
  <li>
    <p>Navigate to the network-scripts directory:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> cd /etc/sysconfig/network-scripts
</code></pre></div>    </div>
  </li>
  <li>
    <p>Delete any ifcfg-*.bak files:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> rm -f /etc/sysconfig/network-scripts/ifcfg-*.bak
</code></pre></div>    </div>
  </li>
  <li>
    <p>Edit every ifcfg-eth* file in the network-scripts directory. Remove the HWADDRESS= line:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> vi ifcfg-eth0

 vi ifcfg-eth1
</code></pre></div>    </div>

    <p>The ifcfg-eth0 file should contain the following:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> DEVICE=eth0
 BOOTPROTO=dhcp
 ONBOOT=yes
</code></pre></div>    </div>

    <p>The ifcfg-eth1 file should contain the following:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> DEVICE=eth1
 BOOTPROTO=dhcp
 ONBOOT=yes
</code></pre></div>    </div>
  </li>
  <li>
    <p>Reboot the computer:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> shutdown -r now
</code></pre></div>    </div>
  </li>
  <li>
    <p>Check the ifcfg-eth* files to make sure there are no ifcfg-eth* files and that the HWADDRESS= lines have not been automatically added back:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ls /etc/sysconfig/network-scripts

 cat /etc/sysconfig/network-scripts/ifcfg-eth0

 cat /etc/sysconfig/network-scripts/ifcfg-eth1
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="run-vcld--setup">Run vcld -setup</h4>
<ol>
  <li>
    <p>Run the following command on the management node:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> /usr/local/vcl/bin/vcld -setup
</code></pre></div>    </div>
  </li>
  <li>
    <p>Navigate the menu options (Note: the names and numbers of the menu items may not match your installation):</p>
    <ul>
      <li>Select a module to configure: VCL Image State Module</li>
      <li>Choose an operation: Capture Base Image</li>
      <li>
        <p>Enter the VCL login name or ID of the user who will own the image:</p>

        <p>Enter your VCL user ID or the user ID of the user you want to own the image.  Pressing Enter without entering a user login ID will cause admin to be the owner of the new base image.</p>
      </li>
      <li>
        <p>Enter the hostname or IP address of the computer to be captured:</p>

        <p>Enter the name or private IP address of the computer which has already added to the VCL database.</p>
      </li>
      <li>Select the OS to be captured:
        <ol>
          <li>VMware Linux</li>
          <li>VMware Windows 2003 Server</li>
          <li>VMware Windows 7</li>
          <li>VMware Windows Server 2008</li>
          <li>VMware Windows Vista</li>
          <li>VMware Windows XP</li>
        </ol>
      </li>
      <li>Image architecture:
        <ol>
          <li>x86</li>
          <li>x86_64</li>
        </ol>
      </li>
      <li>Use Sysprep:
        <ol>
          <li>Yes</li>
          <li>
            <p>No</p>

            <p>Sysprep is usually only required if the image will be loaded on bare metal computers with varying different hardware.</p>
          </li>
        </ol>
      </li>
      <li>
        <p>Enter the name of the image to be captured:</p>

        <p>The name you enter is the name that will be displayed in the list of environments.  It may contain spaces but including other special characters is not recommended.</p>
      </li>
    </ul>
  </li>
</ol>

<p>The following happens once you enter an image name and press enter:</p>

<ul>
  <li>A new image is added to the VCL database</li>
  <li>An imaging request is added to the VCL database</li>
  <li>The vcld -setup automatically initiates ‘tail -f /var/log/vcld.log’ to monitor the vcld log file.  The output should be displayed on the screen.</li>
</ul>

<p>Watch the vcld logfile output to determine if the image capture process is successful or terminated because a problem occurred.  When the capture process terminates, there will either be a message near the end of the output saying “image capture successful” or there will be several WARNING messages, the last of which says something to the effect “image failed to be captured”.  Further troubleshooting is required if the image fails to be captured.</p>

<h4 id="add-the-base-image-to-an-image-group">Add the Base Image to an Image Group</h4>

<p>The vcld -setup utility does not add the new base image to any image groups.  You must add the image to an image group using the VCL website after the image capture process is complete.  Reservations for the image cannot be made until this is done.  To add the image to an image group, browse to the VCL website and select Manage Images &gt; Edit Image Grouping.</p>


      
      <div class="footer border-top border-gray-light mt-5 pt-3 text-right text-gray">
        This site is open source. <a href="http://github.com/pathoma4/vcl/edit/gh-pages/CreateALinuxBaseImage.md">Improve this page</a>.
      </div>
      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
