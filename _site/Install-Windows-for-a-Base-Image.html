<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Install Windows for a Base Image | vcl</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Install Windows for a Base Image" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Documentation for the Apache VCL (Virtual Computing Lab) project" />
<meta property="og:description" content="Documentation for the Apache VCL (Virtual Computing Lab) project" />
<link rel="canonical" href="http://localhost:4000/Install-Windows-for-a-Base-Image.html" />
<meta property="og:url" content="http://localhost:4000/Install-Windows-for-a-Base-Image.html" />
<meta property="og:site_name" content="vcl" />
<script type="application/ld+json">
{"headline":"Install Windows for a Base Image","url":"http://localhost:4000/Install-Windows-for-a-Base-Image.html","description":"Documentation for the Apache VCL (Virtual Computing Lab) project","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=8e39195660e6f869e7e96fab88a6f0a9eb1563db">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">

      <h1><a href="http://localhost:4000/">Install Windows for a Base Image</a></h1> 


      <p>This page describes how to mount the Windows installation media and install Windows for a base image.</p>

<h3 id="mount-the-installation-media">Mount the Installation Media</h3>

<p>The Windows installation media needs to be mounted as a drive on the computer. The method to do this varies widely based on the provisioning engine being used and resources available. The following lists some ways to mount the installation media:</p>

<h4 id="vmware---configure-the-vm-to-mount-the-iso-image-as-a-cd-rom-drive">VMware - Configure the VM to mount the ISO image as a CD-ROM drive</h4>

<p>Note: these instructions assume a VM has already been created</p>

<ol>
  <li>Copy the Windows installation ISO file to the VMware host server</li>
  <li>Add a CD-ROM drive which mounts the Windows installation ISO image by editing the virtual machine settings:
    <ol>
      <li>Connection: Use ISO image:</li>
      <li>Browse to path of Windows installation ISO image</li>
      <li>Save the VM configuration</li>
    </ol>
  </li>
</ol>

<h4 id="xcat-using-ibm-advanced-management-module">xCAT using IBM Advanced Management Module</h4>

<ol>
  <li>Copy the Windows installation ISO file to the management node</li>
  <li>Determine the IP address or hostname of the IBM Advanced Management Module (AMM) for the BladeCenter chassis which contains the blade you are installing</li>
  <li>Open a web browser and enter the AMM’s address</li>
  <li>Log in to the AMM</li>
  <li>Select Inactive session timeout value: no timeout</li>
  <li>Click Start New Session</li>
  <li>Click Remote Control</li>
  <li>Click Start Remote Control</li>
  <li>Set the Media Tray and KVM dropdown menus to the blade you are installing</li>
  <li>Click Select Image and click the arrow button to the right of it</li>
  <li>Navigate to the Windows installation ISO file which was saved to the management node and click Open</li>
  <li>Click Mount All</li>
</ol>

<h3 id="boot-to-the-windows-installation-cd-or-dvd">Boot to the Windows Installation CD or DVD</h3>
<ol>
  <li>Power on the computer</li>
  <li>Press the key to display the boot menu as soon as the computer’s POST screen is displayed (usually F12 for bare metal blades or ESC for VMware)</li>
  <li>Boot from the CD-ROM drive</li>
  <li>Press a key to boot from the CD (this may be displayed at bottom of screen as soon as the computer begins to boot)</li>
</ol>

<h3 id="install-windows">Install Windows</h3>

<p>The Windows installation sequence varies by version. The next 2 sections describe the recommended answers for Windows XP and Windows 7.</p>

<h4 id="windows-xp-installation">Windows XP Installation</h4>

<ol>
  <li>Press Enter to setup up Windows XP now</li>
  <li>Press F8 to agree to the license agreement</li>
  <li>Configure the Windows partition
    <ol>
      <li>Press Enter to set up Windows XP on the selected item (should be called “Unpartitioned space”)</li>
      <li>Format the partition using the NTFS file system (Quick)</li>
    </ol>
  </li>
  <li>Region and Language Options - click Next</li>
  <li>Name: VCL</li>
  <li>Organization: Apache.org</li>
  <li>Enter your Windows XP product key</li>
  <li>Computer name: (doesn’t matter)</li>
  <li>Administrator password: (doesn’t matter, but it’s recommended that password should match the WINDOWS_ROOT_PASSWORD setting in /etc/vcl/vcld.conf)</li>
  <li>Select the timezone</li>
  <li>Networking settings: Typical</li>
  <li>Member of a domain: No, leave default workgroup settings</li>
  <li>Automatic updates: Not right now</li>
  <li>Connect to Internet: Skip</li>
  <li>Register: no</li>
  <li>
    <p>User name: root</p>

    <p><em>Windows XP setup should finish and the root account created during installation should automatically log on</em></p>
  </li>
  <li>
    <p>Once the desktop appears, set root’s password via the Windows GUI or by executing the following command from a command prompt:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   net user root &lt;password&gt;
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="windows-7-installation">Windows 7 Installation</h3>

<ol>
  <li>Enter the regional information:
    <ol>
      <li>Language to install: English</li>
      <li>Time and currency format: English (United States)</li>
      <li>Keyboard or input method: US</li>
    </ol>
  </li>
  <li>Click Next</li>
  <li>
    <p>Click Install now</p>

    <p><em>Setup is starting…</em></p>
  </li>
  <li>Click the checkbox next to “I accept the license terms”</li>
  <li>Click Next</li>
  <li>Click Custom (advanced)</li>
  <li>On the “Where do you want to install Windows?” page, delete all existing partitions and create a new partition using all of the available space:
    <ol>
      <li>Click Drive options (advanced)</li>
      <li>Click Delete, then click OK to confirm</li>
      <li>Click New</li>
      <li>
        <p>Click Apply (the size should be set to the maximum amount available</p>

        <p><em>To ensure that all Windows features work correctly, Windows might create additional partitions for system files.</em></p>
      </li>
      <li>Click OK</li>
    </ol>
  </li>
  <li>
    <p>Click Next’</p>

    <p><em>Installing Windows…
 Windows restarts
 Starting Windows
 Setup is updating registry settings</em></p>
  </li>
  <li>A screen titled “Set Up Windows” appears:
    <ul>
      <li>Type a user name: root</li>
      <li>Type a computer name: it’s best to name the computer after the OS (Example: win7sp1-ent)</li>
    </ul>
  </li>
  <li>Enter a password, password hint, and click Next</li>
  <li>Help protect your computer and improve Windows automatically: Ask me later</li>
  <li>
    <p>Select a time zone, set the correct time, and click Next</p>

    <p><em>Windows is finalizing your settings
Preparing your desktop
Desktop appears</em></p>
  </li>
  <li>if asked to set a network location, choose Work network.</li>
</ol>

<h4 id="windows-server-2008">Windows Server 2008</h4>

<ol>
  <li>Select the language and click Next</li>
  <li>Click Install Now</li>
  <li>Select the version of Windows you want to install from the list and click Next. (Windows Server 2008 R2 Datacenter (Full Installation) was selected when creating these instructions.)</li>
  <li>Click the checkbox next to I accept the license terms and click Next</li>
  <li>Click Custom (advanced)</li>
  <li>Configure the disk partitions and click Next.  Unless you have reason not to, it’s best to delete all existing partitions and then select Unallocated Space. This causes the disk to be repartitioned using all of the available space.</li>
  <li>Click OK and set a password for the Administrator account, click OK</li>
</ol>

<p>The root user account is not created during the installation of Windows Server 2008. It must be created after Windows is installed. Do this using the GUI or run the following commands in a command window:</p>

<ol>
  <li>Click Start &gt; Administrative Tools &gt; Server Manager</li>
  <li>Open Configuration &gt; Local Users and Groups &gt; Users</li>
  <li>Open the Action menu &gt; New User
    <ol>
      <li>User name: root</li>
      <li>Enter a password twice</li>
      <li>User must change password at next logon: no</li>
      <li>Password never expires: yes</li>
      <li>Click Create</li>
      <li>Click Close</li>
    </ol>
  </li>
  <li>Double-click the root user</li>
  <li>Select the Member Of tab</li>
  <li>Click Add
    <ol>
      <li>Enter the object names to select: Administrators</li>
    </ol>
  </li>
  <li>Click OK twice</li>
</ol>

<p>The Disk Cleanup utility (cleanmgr.exe) is not available on Windows Server 2008 unless the the Desktop Experience feature is installed. VCL runs cleanmgr.exe before an image is captured to reduce the amount of space the image consumes. Image captures will not fail if cleanmgr.exe is not installed but it is recommended to install the Desktop Experience feature so that it is available:</p>

<ol>
  <li>Open the Control Panel</li>
  <li>Click Turn Windows features on or off</li>
  <li>Click Features</li>
  <li>Click Add Features</li>
  <li>Click the checkbox next to Desktop Experience</li>
  <li>Click Add Required Features</li>
  <li>Click Next</li>
  <li>Click Install</li>
  <li>Click Close</li>
  <li>Click No to not reboot the computer</li>
  <li>Restart the computer after the installation is complete</li>
</ol>

<h3 id="optional-windows-configuration-tasks">Optional Windows Configuration Tasks</h3>

<h4 id="enable-remote-desktop">Enable Remote Desktop</h4>

<p>The remaining configuration tasks will be easier if you are able to connect to the Windows computer via RDP rather than using the VMware or BladeCenter Management Module console. This step is optional. The VCL image capture process will configure RDP on the Windows computer during image capture and load processes.</p>

<h5 id="windows-xp--windows-server-2003">Windows XP &amp; Windows Server 2003:</h5>

<ol>
  <li>Open Control Panel &gt; System &gt; Remote tab</li>
  <li>Click the checkbox next to Allow users to connect remotely to this computer</li>
  <li>Click OK</li>
</ol>

<h5 id="windows-vista-windows-7--windows-server-2008">Windows Vista, Windows 7, &amp; Windows Server 2008:</h5>

<ol>
  <li>Open Control Panel &gt; System and Security &gt; System</li>
  <li>Click Remote settings</li>
  <li>Select Allow connections from computers running any version of Remote Desktop (less secure)</li>
  <li>Click OK</li>
</ol>

<p>Use an RDP client to connect to the Windows computer using either its public or private IP address as appropriate. If the public address is not available for some reason, you can attempt to connect to the private IP address by installing rdesktop on the management node:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    yum install rdesktop -y

    rdesktop -g 1024x768 &lt;IP address&gt; &amp;
</code></pre></div></div>

<h4 id="disable-internet-explorer-enhanced-security-configuration">Disable Internet Explorer Enhanced Security Configuration</h4>

<p>Internet Explorer Enhanced Security Configuration (IE ESC) prevents you from being able to access websites unless you add them to the Trusted sites zone.</p>

<ol>
  <li>Open Administrative Tools &gt; Server Manager</li>
  <li>Click Configure IE ESC (on the right side under Security Information)</li>
  <li>Select Off for Administrators and Users</li>
  <li>Click OK</li>
</ol>

<h4 id="set-the-computer-name">Set the Computer Name</h4>

<p>The computer may have been assigned a random computer name. This name will be saved in the captured image. If Sysprep is disabled, this computer name will also be assigned to other computers loaded with the image. It’s helpful to name the computer something descriptive of the image so that you can tell what the image is when you connect to it via SSH.</p>

<ol>
  <li>Open the Control Panel</li>
  <li>Click System and Security &gt; Set the name of this computer</li>
  <li>Click Change settings</li>
  <li>Click Change
    <ol>
      <li>Enter a Computer name and Workgroup</li>
      <li>Click OK 3 times</li>
    </ol>
  </li>
  <li>Click Close</li>
  <li>Click Restart Later</li>
</ol>

<h4 id="disable-user-account-control">Disable User Account Control</h4>

<p>User Account Control (UAC) is the mechanism that causes may of the pop-up windows to appear when you attempt to run programs on Windows 7 and Windows Server 2008. VCL will disable it when the image is captured but you can disable it while configuring the base image to make things a little easier.</p>

<ol>
  <li>Open the Control Panel</li>
  <li>Click System and Security &gt; Change User Account Control settings (Under Action Center)</li>
  <li>Move the slider to the bottom: Never notify</li>
  <li>Click OK</li>
  <li>Reboot the computer</li>
</ol>

<h4 id="configure-windows-boot-options">Configure Windows Boot Options</h4>

<p>It can be helpful to configure the Windows boot options as follows in order to be able to troubleshoot boot problems.</p>

<ol>
  <li>Run msconfig.exe</li>
  <li>Select the Boot tab</li>
  <li>Click the checkboxes next to:
    <ol>
      <li>No GUI boot - Does not display the Windows Welcome screen when starting</li>
      <li>Boot log - Stores all information from the startup process in the file %SystemRoot%Ntbtlog.txt</li>
      <li>OS boot information - Shows driver names as drivers are being loaded during the startup process</li>
    </ol>
  </li>
  <li>Make all boot settings permanent</li>
  <li>Click OK</li>
  <li>Click Yes</li>
  <li>Restart the computer</li>
</ol>

<h3 id="verify-network-connectivity">Verify Network Connectivity</h3>

<p>The computer must be able to connect to the public and private networks.</p>

<ol>
  <li>If DHCP is not being used, configure the IP addresses manually</li>
  <li>Verify that the computer has IP addresses for both the public and private network adapters:
    <ol>
      <li>
        <p>Open a command prompt:</p>

        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> cmd.exe
</code></pre></div>        </div>
      </li>
      <li>
        <p>Check the network configuration:</p>

        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ipconfig /all
</code></pre></div>        </div>
      </li>
      <li>
        <p>Verify Internet access by opening Internet Explorer and browsing to a public website</p>
      </li>
    </ol>
  </li>
</ol>

<p>Some Windows versions (especially Windows Vista) have trouble properly routing outward network traffic if there are multiple network interfaces. If you can not get to the Internet, set the private network interface to ignore default routes which causes all outward traffic not destined for the private network to be sent through the public interface:</p>

<ol>
  <li>Open a command prompt (this must be done as Administrator under Windows 6.x):
Start &gt; All Programs &gt; Accessories &gt; right-click Command prompt &gt; Run as Administrator</li>
  <li>Determine the name of the private interface from the ipconfig output
(should be either “Local Area Connection” or “Local Area Connection 2”)</li>
  <li>
    <p>Execute the command using the private interface name from step 2:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> netsh.exe interface ip set interface "Local Area Connection" ignoredefaultroutes=enabled
</code></pre></div>    </div>

    <ul>
      <li>The command should display Ok.</li>
    </ul>
  </li>
  <li>Attempt to access the Internet again</li>
</ol>

<h3 id="install-windows-updates">Install Windows Updates</h3>

<ol>
  <li>Open Internet Explorer</li>
  <li>Run Windows Update
    <ol>
      <li>Install all recommended updates, reboot if necessary</li>
    </ol>
  </li>
  <li>Run Windows Update again to check for additional updates</li>
</ol>

<h3 id="install-drivers">Install Drivers</h3>

<p>Open up the Device Manager: Control Panel &gt; System &gt; Hardware tab &gt; Device Manager</p>

<p>If any devices are unknown or missing drivers, you will need to locate and download the appropriate driver and install it.</p>

<p>Save a copy of the drivers you had to install in the appropriate Drivers directory on the management node:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    /usr/local/vcl/tools/Windows.../Drivers
</code></pre></div></div>

<p>There are multiple Windows… directories under /usr/local/vcl/tools. The names create a hierarchy so that files which can be used by multiple versions of Windows only need to be stored in a single location on the management node.  There are 3 levels that make up the hierarchy:</p>

<ol>
  <li>
    <p>The directory named Windows should contain files that work on all versions of Windows:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> /usr/local/vcl/tools/Windows/Drivers
</code></pre></div>    </div>
  </li>
  <li>
    <p>The directories named Windows_Version_x should contain files that only work on a particular major version of Windows.</p>

    <p><em>The Windows version number can be obtained by executing ver from a command prompt</em></p>

    <ul>
      <li>
        <p>Windows_Version_5 should contain files that work on versions of Windows numbered 5.x (Windows XP and Windows Server 2003).</p>

        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  /usr/local/vcl/tools/Windows_Version_5/Drivers
</code></pre></div>        </div>
      </li>
      <li>
        <p>Windows_Version_6 should contain files that work on versions of Windows numbered 6.x (Windows Vista, Windows Server 2008, and Windows 7).</p>

        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  /usr/local/vcl/tools/Windows_Version_5/Drivers
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>The directories named after a specific version (Windows_XP, Windows_Server_2008, etc.) should contain files that only work on that version.  For example, if a driver only works under XP save it under:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> /usr/local/vcl/tools/Windows_XP/Drivers
</code></pre></div>    </div>
  </li>
</ol>

<p>During the image capture process, the Windows* directories that pertain to the OS being captured are copied to C:\cygwin\home\root\VCL on the Windows computer.  Each Windows* directory is overlayed into the same VCL directory.  They are copied in the order listed above, from most general to most specific. For example, if a Windows Server 2008 image is being captured the directories copied are:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    /usr/local/vcl/tools/Windows

    /usr/local/vcl/tools/Windows_Version_6

    /usr/local/vcl/tools/Windows_Server_2008
</code></pre></div></div>

<p>The directory organization under each Drivers directory does not matter.  However, it’s recommended that they be organized by device type:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    /usr/local/vcl/tools/Windows.../Drivers/Chipset

    /usr/local/vcl/tools/Windows.../Drivers/Network

    /usr/local/vcl/tools/Windows.../Drivers/Storage

    /usr/local/vcl/tools/Windows.../Drivers/Video
</code></pre></div></div>


      
      <div class="footer border-top border-gray-light mt-5 pt-3 text-right text-gray">
        This site is open source. <a href="http://github.com/pathoma4/vcl/edit/gh-pages/InstallWindowsForABaseImage.md">Improve this page</a>.
      </div>
      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
